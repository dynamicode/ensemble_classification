with the incoming of information era, web-based service has been developed rapidly and offered more and more business. these &#8220;open&#8221;, and widely &#8220;web enabled&#8221; applications are subject to greater and greater levels and types of attacks as hackers exploit vulnerabilities within the software like sql injection and cross site scripts (xss) attack. in this paper, we proposed a type of novel embedded markov model (emm) to detect different web application attacks, monitor the on-line user behavior and defend the malevolent user promptly. comparing to previous web application attacks detecting approaches, our emm approach can not only detect user&#8217;s invalidated input errors but also find out the unreasonable page transition behavior. by detecting unreasonable page transition, we can immediately defend the malevolent or silly user behavior to avoid the further web system failures and sensitive information disclosure. furthermore, we implement an on-line user behavior surveillance system and use the real web traffic to evaluate the performance of our system. the experiment results show that our proposed emm method can discover the abnormal behavior of malevolent user and detect the invalidated input attacks like sql injection, xss and string buffer overflow attacks.defending on-line web application security with user-behavior surveillance